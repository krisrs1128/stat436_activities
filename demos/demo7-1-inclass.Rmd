---
title: "Untitled"
output: html_document
date: "`r Sys.Date()`"
---

```{r, echo = FALSE}
knitr::opts_chunk$set(warnings = FALSE, message = FALSE)
```

```{r}
library(sf)
library(tmap)
library(tidyverse)
library(ceramic)

# code to set a clean theme
th <- theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = "#F7F7F7"),
    panel.border = element_rect(fill = NA, color = "#0c0c0c", size = 0.6),
    axis.text = element_text(size = 14),
    axis.title = element_text(size = 16),
    legend.position = "bottom"
  )
theme_set(th)
```

[Glacial Lakes]. The data at this [link](https://raw.githubusercontent.com/krisrs1128/stat436_s23/main/data/GL_3basins_2015.topojson) contain labels of glacial lakes the
Hindu Kush Himalaya, created during an ecological survey in 2015 by the
International Centre for Integrated Mountain Development.

```{r}
lakes <- read_sf("https://raw.githubusercontent.com/krisrs1128/stat436_s23/main/data/GL_3basins_2015.topojson") |>
  mutate(log_area = log(Area))

cols <- c("#023859", "#99ADBF")


lakes

```

a. How many lakes are in this dataset? What are the latitude / longitude
coordinates of the largest lakes in each Sub-basin?

```{r}
lakes |>
    arrange(-Area)

top_lakes <- lakes |>
    group_by(Sub_Basin) |>
    slice_max(Area)

lakes |>
    distinct(Sub_Basin)
```

b. Plot the polygons associated with each of the lakes identified in step
(a). _Hint: You may find it useful to split lakes across panels using the
`tmap_facets` function. If you use this approach, make sure to include a
scale with `tm_scale_bar()`, so that it is clear that lakes have different
sizes.

```{r}
tm_shape(lakes) +
    tm_polygons()

tm_shape(top_lakes) +
    tm_polygons() +
    tm_facets("Sub_Basin") +
    tm_scalebar(position = c("top", "left"))

example(tm_facets_grid)
```


c. Visualize all lakes with latitude between 28.2 and 28.4 and with
longitude between 85.8 and 86. Optionally, add a basemap associated with
each lake.

```{r}
lakes_sub <- lakes |>
    filter(
        Latitude >= 28.2, Latitude <= 28.4,
        Longitude >= 85.8, Longitude <= 86
    )

st_crs(lakes_sub, "4326")
lakes_sub <- st_sf(lakes_sub, crs = 4326)
tm_shape(lakes_sub) +
    tm_polygons()


tmap_mode("view")
tm_basemap("Esri.WorldImagery") +
    tm_shape(lakes_sub) +
    tm_polygons(alpha = 0.1)

tm_basemap("Esri.WorldImagery") +
    tm_shape(lakes) +
    tm_polygons(col = "red", alpha = 1)

#Sys.setenv(MAPBOX_API_KEY="")
#basemap <- cc_location(cbind(85.9, 28.3), buffer = 1e4)
```

```{r}
my_df <- data.frame(
    latitude = rnorm(10),
    longitude = rnorm(10)
)


library(rnaturalearth)
ne_states()

counties <- read_sf("~/Downloads/ne_10m_admin_2_counties/ne_10m_admin_2_counties.shp") |>
    filter(REGION == "WI")

tm_shape(st_cast(lakes, "POINT")) +
    tm_dots()

for (i in seq_len(nrow(lakes))) {
    lakes[i] <- st_centroid(lakes[i, ], "POINT")
}

tm_shape(st_centroid(lakes)) +
    tm_dots()

counties
```